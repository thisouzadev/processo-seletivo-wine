{"version":3,"sources":["../../server/node-web-streams-helper.ts"],"names":["readableStreamTee","chainStreams","streamFromArray","streamToString","encodeText","decodeText","createBufferedTransformStream","createFlushEffectStream","createHeadInjectionTransformStream","renderToInitialStream","continueFromInitialStream","createSuffixStream","createDeferredSuffixStream","createInlineDataStream","readable","transformStream","TransformStream","transformStream2","writer","writable","getWriter","writer2","reader","getReader","read","then","done","value","close","write","streams","promise","Promise","resolve","i","length","pipeTo","preventClose","strings","forEach","str","stream","textDecoder","TextDecoder","bufferedString","input","TextEncoder","encode","decode","transform","v","pendingFlush","flushBuffer","controller","setTimeout","buffered","enqueue","chunk","flush","handleFlushEffect","flushedChunk","inject","injected","content","index","indexOf","injectedContent","slice","ReactDOMServer","element","streamOptions","renderToReadableStream","renderStream","suffix","dataStream","generateStaticHTML","flushEffectHandler","initialStylesheets","closeTag","suffixUnclosed","split","allReady","transforms","map","href","join","filter","nonNullable","reduce","pipeThrough","suffixFlushed","suffixFlushTask","res","dataStreamFinished","dataStreamReader","err","error"],"mappings":"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"}